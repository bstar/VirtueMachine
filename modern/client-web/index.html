<!doctype html>
<html lang="en" data-theme="obsidian" data-font="sans" data-legacy-frame-preview="off">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>VIRTUE MACHINE | Web Debug View</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Silkscreen:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./styles.css">
  </head>
  <body class="vm-body h-screen overflow-hidden antialiased">
    <main class="h-screen pr-[390px]">
      <section class="h-full px-4 py-4">
        <div class="vm-main-shell h-full rounded p-4 flex flex-col">
          <header class="vm-header mb-3 pb-3 flex items-start justify-between gap-4">
            <div>
              <h1 class="vm-game-title text-2xl font-bold tracking-tight">VIRTUE MACHINE</h1>
              <p class="vm-game-subtitle mt-1 text-sm">Web Debug View</p>
              <p class="vm-game-time mt-2 text-sm">Time of Day: <strong id="topTimeOfDay" class="font-semibold">Midnight (00:00)</strong></p>
              <p class="vm-game-time mt-1 text-sm">Net: <strong id="topNetStatus" class="font-semibold">idle - Not logged in.</strong></p>
            </div>
            <div class="w-[520px] max-w-[52vw] shrink-0 vm-net-header-compact">
              <div class="grid grid-cols-2 gap-2">
                <label class="control-block">
                  <span class="text-[11px] vm-muted-text">Server URL</span>
                  <input id="netApiBaseInput" class="control-input text-xs" type="text" value="http://127.0.0.1:8081" placeholder="http://127.0.0.1:8081" aria-label="Net API Base URL">
                </label>
                <label class="control-block">
                  <span class="text-[11px] vm-muted-text">Account Username</span>
                  <input id="netUsernameInput" class="control-input text-xs" type="text" value="avatar" placeholder="avatar" aria-label="Account Username">
                </label>
                <div class="control-block">
                  <span class="text-[11px] vm-muted-text">Account Password</span>
                  <div class="flex gap-2">
                    <input id="netPasswordInput" class="control-input text-xs flex-1" type="password" value="quest123" placeholder="password" aria-label="Account Password">
                    <button id="netPasswordToggleButton" class="control-btn text-xs px-2" type="button" title="Show password">Show</button>
                  </div>
                </div>
                <label class="control-block">
                  <span class="text-[11px] vm-muted-text">Character Name</span>
                  <input id="netCharacterNameInput" class="control-input text-xs" type="text" value="Avatar" placeholder="Avatar" aria-label="Character Name">
                </label>
              </div>
              <div class="grid grid-cols-2 gap-2 mt-2">
                <label class="control-block">
                  <span class="text-[11px] vm-muted-text">Recovery Email</span>
                  <input id="netEmailInput" class="control-input text-xs" type="text" value="" placeholder="user@example.com" aria-label="Recovery Email">
                </label>
                <label class="control-block">
                  <span class="text-[11px] vm-muted-text">Email Verify Code</span>
                  <input id="netEmailCodeInput" class="control-input text-xs" type="text" value="" placeholder="6-digit code" aria-label="Email Verify Code">
                </label>
              </div>
              <div class="grid grid-cols-2 gap-2 mt-2">
                <button id="netLoginButton" class="control-btn text-xs" type="button">Net Login (I)</button>
                <button id="netRecoverButton" class="control-btn text-xs" type="button">Recover Pass</button>
              </div>
              <div class="grid grid-cols-3 gap-2 mt-2">
                <button id="netSetEmailButton" class="control-btn text-xs" type="button">Set Email</button>
                <button id="netSendVerifyButton" class="control-btn text-xs" type="button">Send Code</button>
                <button id="netVerifyEmailButton" class="control-btn text-xs" type="button">Verify Email</button>
              </div>
            </div>
          </header>
          <div class="flex-1 min-h-0 flex items-center justify-center">
            <div class="vm-world-frame">
              <div class="vm-world-inset">
                <div id="legacyWorldSurface" class="vm-world-surface">
                  <canvas id="legacyBackdrop" class="vm-legacy-backdrop" aria-hidden="true"></canvas>
                  <canvas id="legacyViewport" class="vm-legacy-viewport" aria-hidden="true"></canvas>
                  <canvas id="viewport" width="704" height="704" class="vm-canvas max-h-full max-w-full rounded"></canvas>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <aside class="vm-side-panel smart-scroll fixed right-0 top-0 h-screen w-[390px] p-4 overflow-y-auto">
        <div class="vm-header mb-4 pb-3">
          <h2 class="text-lg font-semibold">Debug Panel</h2>
          <p class="vm-muted-text text-xs">Runtime status, controls, and rendering diagnostics</p>
        </div>

        <div class="space-y-2 text-sm">
          <div class="stat-row"><span>Tick</span><strong id="statTick">0</strong></div>
          <div class="stat-row"><span>Map Position</span><strong id="statPos">0, 0, 0</strong></div>
          <div class="stat-row"><span>Clock</span><strong id="statClock">00:00</strong></div>
          <div class="stat-row"><span>Date</span><strong id="statDate">1 / 1 / 1</strong></div>
          <div class="stat-row"><span>Tile</span><strong id="statTile">-</strong></div>
          <div class="stat-row"><span>Object Overlay</span><strong id="statObjects">0 / 0</strong></div>
          <div class="stat-row"><span>Entity Overlay</span><strong id="statEntities">0 / 0</strong></div>
          <div class="stat-row"><span>Render Parity</span><strong id="statRenderParity">ok</strong></div>
          <div class="stat-row"><span>Avatar State</span><strong id="statAvatarState">ghost</strong></div>
          <div class="stat-row"><span>NPC Occlusion Blocks</span><strong id="statNpcOcclusionBlocks">0</strong></div>
          <div class="stat-row"><span>Commands Queued</span><strong id="statQueued">0</strong></div>
          <div class="stat-row"><span>Data Source</span><strong id="statSource">booting...</strong></div>
          <div class="stat-row"><span>State Hash</span><strong id="statHash">-</strong></div>
          <div class="stat-row"><span>Replay Check</span><strong id="statReplay">not run</strong></div>
          <div class="stat-row"><span>Palette Phase</span><strong id="statPalettePhase">-</strong></div>
          <div class="stat-row"><span>Center Tile IDs</span><strong id="statCenterTiles">-</strong></div>
          <div class="stat-row"><span>Center Palette Band</span><strong id="statCenterBand">-</strong></div>
          <div class="stat-row"><span>Net Session</span><strong id="statNetSession">offline</strong></div>
          <div class="stat-row"><span>Net Players</span><strong id="statNetPlayers">1</strong></div>
          <div class="stat-row"><span>Critical Recoveries</span><strong id="statCriticalRecoveries">0</strong></div>
        </div>

        <div class="mt-4 space-y-3">
          <div class="control-block"><label for="themeSelect">Theme</label><select id="themeSelect" class="control-input"><option value="obsidian">Obsidian Codex</option><option value="phosphor">Phosphor CRT</option><option value="amber">Amber Terminal</option><option value="cga-cyan">CGA Cyan Steel</option><option value="cga-magenta">CGA Magenta Night</option><option value="parchment">Parchment Atlas</option><option value="cobalt">Cobalt Keep</option><option value="bloodstone">Bloodstone Banner</option><option value="moonstone">Moonstone Ledger</option><option value="ash">Ash Monolith</option></select></div>
          <div class="control-block"><label for="fontSelect">Body Font</label><select id="fontSelect" class="control-input"><option value="sans">Sans UI (Default)</option><option value="silkscreen">Silkscreen</option><option value="kaijuz">Kaijuz</option><option value="orangekid">Orange Kid</option><option value="blockblueprint">BlockBlueprint</option></select></div>
          <div class="control-block"><label for="gridToggle">Viewport Grid</label><select id="gridToggle" class="control-input"><option value="off">Off (Default)</option><option value="on">On</option></select></div>
          <div class="control-block"><label for="debugOverlayToggle">Overlay Debug</label><select id="debugOverlayToggle" class="control-input"><option value="off">Off (Default)</option><option value="on">On</option></select></div>
          <div class="control-block"><label for="animationToggle">Animation</label><select id="animationToggle" class="control-input"><option value="live">Live (Tick-Driven)</option><option value="freeze">Freeze (Debug)</option></select></div>
          <div class="control-block"><label for="paletteFxToggle">Legacy Palette FX</label><select id="paletteFxToggle" class="control-input"><option value="on">On (Default)</option><option value="off">Off</option></select></div>
          <div class="control-block"><label for="movementModeToggle">Control Mode</label><select id="movementModeToggle" class="control-input"><option value="ghost">Ghost (No Collision)</option><option value="avatar">Avatar (Collision + Doors)</option></select></div>
          <div class="control-block"><label for="renderModeToggle">Render Mode</label><select id="renderModeToggle" class="control-input"><option value="current">Current (Stable)</option><option value="nuvie">Nuvie Refactor</option></select></div>
          <div class="control-block"><label for="capturePreviewToggle">Legacy Frame Preview</label><select id="capturePreviewToggle" class="control-input"><option value="off">Off</option><option value="on">On (Default)</option></select></div>
          <div class="control-block"><label for="legacyScaleModeToggle">Legacy Scale</label><select id="legacyScaleModeToggle" class="control-input"><option value="fit">Integer Fit</option><option value="1">Perfect 1x (320x200)</option><option value="2">2x</option><option value="3">3x</option><option value="4">4x (Default)</option></select></div>
          <div class="control-block"><label for="locationSelect">Capture Preset</label><select id="locationSelect" class="control-input"></select></div>
          <div class="grid grid-cols-2 gap-2">
            <button id="jumpButton" class="control-btn" type="button">Jump (G)</button>
            <button id="captureButton" class="control-btn" type="button">Capture (P)</button>
            <button id="captureWorldHudButton" class="control-btn col-span-2" type="button">Capture World+HUD (Shift+P)</button>
          </div>

          <div class="grid grid-cols-2 gap-2">
            <button id="netSaveButton" class="control-btn" type="button">Save Remote (Y)</button>
            <button id="netLoadButton" class="control-btn" type="button">Load Remote (U)</button>
          </div>
          <div class="control-block"><label for="netMaintenanceToggle">Critical Maintenance</label><select id="netMaintenanceToggle" class="control-input"><option value="off">Off (Default)</option><option value="on">Auto (every 120 ticks)</option></select></div>
          <div class="grid grid-cols-2 gap-2">
            <button id="netMaintenanceButton" class="control-btn col-span-2" type="button">Run Maintenance (N)</button>
          </div>
        </div>

        <div class="mt-4 vm-char-stub-panel p-2">
          <h3 class="text-sm font-semibold">Legacy Character Stubs</h3>
          <p class="vm-muted-text text-xs">Avatar + nearest actors (temporary visual fill-in)</p>
          <canvas id="charStubCanvas" width="336" height="112" class="vm-char-stub-canvas mt-2"></canvas>
        </div>

        <a class="vm-replay-link mt-4 block text-xs underline decoration-dotted disabled" id="replayDownload" href="#">download replay checkpoints.csv</a>

        <div class="diag mt-4 p-2 text-xs" id="diagBox">
          awaiting runtime checks...
        </div>

        <div class="vm-help mt-4 p-3 text-xs">
          <h3 class="mb-2 text-sm font-semibold">Controls</h3>
          <p>`W A S D` or `H J K L` move</p>
          <p>`R` recenter</p>
          <p>`O` toggle overlay debug labels</p>
          <p>`G` jump to selected capture preset</p>
          <p>`P` capture viewport png</p>
          <p>`Shift+P` capture world + HUD png</p>
          <p>`V` verify replay stability</p>
          <p>`F` toggle animated tile freeze</p>
          <p>`B` toggle legacy palette FX</p>
          <p>`M` toggle ghost/avatar mode</p>
          <p>`E` interact with facing door (avatar mode)</p>
          <p>`I` net login/logout toggle (selected user/password)</p>
          <p>Password recovery requires verified recovery email</p>
          <p>Journey Onward requires login</p>
          <p>`Y` save current sim snapshot to net backend</p>
          <p>`U` load sim snapshot from net backend</p>
          <p>`N` run critical-item maintenance now</p>
          <p>`,` / `.` cycle cursor glyph</p>
          <p>`[` / `]` cycle legacy scale</p>
        </div>
      </aside>
    </main>
    <script type="module" src="./app.js"></script>
  </body>
</html>
